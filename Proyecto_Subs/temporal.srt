<?php
require_once __DIR__ . '/vendor/autoload.php';
use PhpAmqpLib\Connection\AMQPStreamConnection;
use PhpAmqpLib\Message\AMQPMessage;

$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');
$channel_bitacora = $connection->channel();
$channel_tuit = $connection->channel();
$channel_bitacora->queue_declare('bitacora', false, false, false, false);
$channel_tuit->queue_declare('tuit', false, false, false, false);

$post_data = array(
	'tuit' => $_GET['tuit'],
        'uid'=> $_GET['uid']);

echo json_encode($post_data);

$msg = new AMQPMessage(json_encode($post_data));

$channel_bitacora->basic_publish($msg, '', 'bitacora');
$channel_tuit->basic_publish($msg, '', 'tuit');

#$msg = new AMQPMessage('hello world');
#$channel->basic_publish($msg, '', 'hello');

#$data = implode(' ', array_slice($argv, 1));
#if(empty($data)) $data = "Hello world!";
#$msg = new AMQPMessage($data, array('delivery_mode' => 2)); # persistent

#$channel->basic_publish($msg, '', 'task_queue');

#echo "[x] sent hello world \n";

echo "sent";
$channel_feed->close();
$channel_bitacora->close();
$connection->close();
?>

